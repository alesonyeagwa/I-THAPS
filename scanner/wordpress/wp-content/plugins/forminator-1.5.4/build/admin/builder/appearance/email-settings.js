!function(e){formintorjs.define(["text!tpl/appearance.html"],function(a){return Backbone.View.extend({mainTpl:Forminator.Utils.template(e(a).find("#appearance-section-emails-tpl").html()),advancedDeliveryTpl:Forminator.Utils.template(e(a).find("#forminator-advanced-email-delivery").html()),textEditorTpl:Forminator.Utils.template(e(a).find("#forminator-text-editor").html()),className:"sui-box",initialize:function(e){return this.render()},render:function(){this.$el.html(this.mainTpl()),this.render_user_email(),this.render_admin_email(),this.render_override_defaults()},render_override_defaults:function(){var e=new Forminator.Settings.ToggleContainer({model:this.model,id:"appearance-override-defaults",hide_label:!0,name:"override-defaults",values:[{value:"true",label:Forminator.l10n.tab_emails.override_defaults}]}),a=new Forminator.Settings.Text({model:this.model,id:"emails-override-sender-email",label:Forminator.l10n.tab_emails.override_sender_mail,placeholder:Forminator.l10n.tab_emails.override_sender_mail_placeholder,name:"override-sender-mail"}),t=new Forminator.Settings.Text({model:this.model,id:"emails-override-sender-name",label:Forminator.l10n.tab_emails.override_sender_name,placeholder:Forminator.l10n.tab_emails.override_sender_name_placeholder,name:"override-sender-name"});e.$el.find(".fui-box-gray").append([a.el,t.el]),this.$el.find("#forminator-formwiz-override-defaults").append(e.el)},render_user_email:function(){var a=new Forminator.Settings.ToggleContainer({model:this.model,id:"appearance-user-email",hide_label:!0,name:"use-user-email",values:[{value:"true",label:Forminator.l10n.tab_emails.send_user_email}]}),t=new Forminator.Settings.Text({model:this.model,id:"emails-user-email-title",label:Forminator.l10n.tab_emails.email_subject,placeholder:Forminator.l10n.tab_emails.subject,name:"user-email-title"}),i=new Forminator.Settings.Editor({model:this.model,id:"emails-user-email-editor",hide_label:!0,placeholder:Forminator.l10n.tab_emails.hello_user,name:"user-email-editor",enableFormData:!0}),l=!1;(this.model.get("user-email-from-name")||this.model.get("user-email-from-address")||this.model.get("user-email-reply-to-address")||this.model.get("user-email-cc-address")||this.model.get("user-email-bcc-address"))&&(l=!0),a.$el.find(".fui-box-gray").append([t.el,i.el,this.advancedDeliveryTpl({is_open:l})]);var r=this.get_viable_options_for_names(),n=[{value:"",label:Forminator.l10n.tab_emails.default}];n=_.union(n,this.get_viable_options_for_emails());var o=new Forminator.Settings.Text({model:this.model,id:"user-email-from-name",hide_label:!0,name:"user-email-from-name",placeholder:Forminator.l10n.tab_emails.default}),m=this.textEditorTpl({input_id:"user-email-from-name",fields:r,label:Forminator.l10n.tab_emails.email_from_name});m=e(m),m.find(".sui-insert-variables").prepend(o.el);var s=new Forminator.Settings.Select2({model:this.model,id:"user-email-from-address",hide_label:!1,label:Forminator.l10n.tab_emails.email_from_address,name:"user-email-from-address",auto_create_on_non_exist:!0,values:n,attr_data:{"data-tags":"true"},select2_options:{createTag:function(a){var t=e.trim(a.term);return Forminator.Utils.is_email_wp(t)?{id:t,text:t}:null}}}),d=new Forminator.Settings.Select2({model:this.model,id:"user-email-reply-to-address",hide_label:!1,label:Forminator.l10n.tab_emails.email_reply_to_address,name:"user-email-reply-to-address",auto_create_on_non_exist:!0,values:_.filter(n,function(e,a){return 0===a?e.label=Forminator.l10n.tab_emails.none:e}),attr_data:{"data-tags":"true"},select2_options:{createTag:function(a){var t=e.trim(a.term);return Forminator.Utils.is_email_wp(t)?{id:t,text:t}:null}}}),u=new Forminator.Settings.Select2({model:this.model,id:"user-email-cc-address",hide_label:!1,label:Forminator.l10n.tab_emails.email_cc_address,name:"user-email-cc-address",auto_create_on_non_exist:!0,values:_.rest(n),attr_data:{"data-tags":"true",multiple:"multiple"},select2_options:{placeholder:Forminator.l10n.tab_emails.none,createTag:function(a){var t=e.trim(a.term);return Forminator.Utils.is_email_wp(t)?{id:t,text:t}:null}}}),c=new Forminator.Settings.Select2({model:this.model,id:"user-email-bcc-address",hide_label:!1,label:Forminator.l10n.tab_emails.email_bcc_address,name:"user-email-bcc-address",auto_create_on_non_exist:!0,values:_.rest(n),attr_data:{"data-tags":"true",multiple:"multiple"},select2_options:{placeholder:Forminator.l10n.tab_emails.none,createTag:function(a){var t=e.trim(a.term);return Forminator.Utils.is_email_wp(t)?{id:t,text:t}:null}}});a.$el.find("#forminator-advanced-email-delivery-options").append([m,s.el,d.el,u.el,c.el]),this.$el.find("#forminator-formwiz-user-email").append(a.el)},render_admin_email:function(){var a=new Forminator.Settings.ToggleContainer({model:this.model,id:"appearance-admin-email",hide_label:!0,name:"use-admin-email",values:[{value:"true",label:Forminator.l10n.tab_emails.send_admins_email}]}),t=new Forminator.Settings.Text({model:this.model,id:"emails-admin-email-title",label:Forminator.l10n.tab_emails.email_subject,placeholder:Forminator.l10n.tab_emails.subject,name:"admin-email-title"}),i=this.get_admin_email_recipents(),l=new Forminator.Settings.Editor({model:this.model,id:"emails-admin-email-editor",hide_label:!0,placeholder:Forminator.l10n.tab_emails.hello_admin,name:"admin-email-editor",enableFormData:!0,enableAllFormFields:!0,enablePostData:!0,enableUpload:!0}),r=!1;(this.model.get("admin-email-from-name")||this.model.get("admin-email-from-address")||this.model.get("admin-email-reply-to-address")||this.model.get("admin-email-cc-address")||this.model.get("admin-email-bcc-address"))&&(r=!0),a.$el.find(".fui-box-gray").append([i.el,t.el,l.el,this.advancedDeliveryTpl({is_open:r})]);var n=this.get_viable_options_for_names(),o=[{value:"",label:Forminator.l10n.tab_emails.default}];o=_.union(o,this.get_viable_options_for_emails());var m=new Forminator.Settings.Text({model:this.model,id:"admin-email-from-name",hide_label:!0,name:"admin-email-from-name",placeholder:Forminator.l10n.tab_emails.default}),s=this.textEditorTpl({input_id:"admin-email-from-name",fields:n,label:Forminator.l10n.tab_emails.email_from_name});s=e(s),s.find(".sui-insert-variables").prepend(m.el);var d=new Forminator.Settings.Select2({model:this.model,id:"admin-email-from-address",hide_label:!1,label:Forminator.l10n.tab_emails.email_from_address,name:"admin-email-from-address",auto_create_on_non_exist:!0,values:o,attr_data:{"data-tags":"true"},select2_options:{createTag:function(a){var t=e.trim(a.term);return Forminator.Utils.is_email_wp(t)?{id:t,text:t}:null}}}),u=new Forminator.Settings.Select2({model:this.model,id:"admin-email-reply-to-address",hide_label:!1,label:Forminator.l10n.tab_emails.email_reply_to_address,name:"admin-email-reply-to-address",auto_create_on_non_exist:!0,values:_.filter(o,function(e,a){return 0===a?e.label=Forminator.l10n.tab_emails.none:e}),attr_data:{"data-tags":"true"},select2_options:{createTag:function(a){var t=e.trim(a.term);return Forminator.Utils.is_email_wp(t)?{id:t,text:t}:null}}}),c=new Forminator.Settings.Select2({model:this.model,id:"admin-email-cc-address",hide_label:!1,label:Forminator.l10n.tab_emails.email_cc_address,name:"admin-email-cc-address",auto_create_on_non_exist:!0,values:_.rest(o),attr_data:{"data-tags":"true",multiple:"multiple"},select2_options:{placeholder:Forminator.l10n.tab_emails.none,createTag:function(a){var t=e.trim(a.term);return Forminator.Utils.is_email_wp(t)?{id:t,text:t}:null}}}),p=new Forminator.Settings.Select2({model:this.model,id:"admin-email-bcc-address",hide_label:!1,label:Forminator.l10n.tab_emails.email_bcc_address,name:"admin-email-bcc-address",auto_create_on_non_exist:!0,values:_.rest(o),attr_data:{"data-tags":"true",multiple:"multiple"},select2_options:{placeholder:Forminator.l10n.tab_emails.none,createTag:function(a){var t=e.trim(a.term);return Forminator.Utils.is_email_wp(t)?{id:t,text:t}:null}}});a.$el.find("#forminator-advanced-email-delivery-options").append([s,d.el,u.el,c.el,p.el]),this.$el.find("#forminator-formwiz-admins-email").append(a.el)},get_admin_email_recipents:function(){return new Forminator.Settings.Tag({model:this.model,id:"emails-admin-email-recipents",label:Forminator.l10n.tab_emails.choose_recipients,name:"admin-email-recipients",tags_options:{placeholder:Forminator.l10n.tab_emails.recipients,ajax:{url:Forminator.Data.ajaxUrl,type:"POST",delay:350,data:function(e){return{action:"forminator_builder_search_emails",_wpnonce:Forminator.Data.searchNonce,q:e.term}},processResults:function(e){return{results:e.data}},cache:!0},templateResult:function(a){return _.isUndefined(a.id)||_.isUndefined(a.text)||_.isUndefined(a.display_name)?a.text:e("<span><b>"+a.text+"</b> - <small>"+a.display_name+"</small></span>")},createTag:function(a){var t=e.trim(a.term);return Forminator.Utils.is_email_wp(t)?{id:t,text:t}:null}}})},get_viable_options_for_names:function(){var e=[],a=Forminator.Utils.get_fields(this.model.get("wrappers"),["pagination","postdata","upload","captcha","date","time","email","gdprcheckbox","checkbox"]);return _.each(a,function(a){e.push({value:"{"+a.element_id+"}",label:a.label})}),e},get_viable_options_for_emails:function(){var e=[],a=Forminator.Utils.get_fields(this.model.get("wrappers"),["address","captcha","date","gdprcheckbox","html","name","number","pagination","phone","postdata","section","select","time","upload","website"]);return _.each(a,function(a){e.push({value:"{"+a.element_id+"}",label:a.label})}),e}})})}(jQuery);