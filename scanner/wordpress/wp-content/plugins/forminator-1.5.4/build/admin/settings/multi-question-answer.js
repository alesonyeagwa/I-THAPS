!function(e){formintorjs.define(["admin/settings/multi-setting","text!tpl/fields.html"],function(t,i){return t.extend({multiple:!1,events:{"click .fui-add-indicator":"add_answer","click .fui-answer-open-indicator":"toggle_answer","click .fui-answer-delete":"delete_answer","click .fui-open-media":"add_image","click .fui-browse-delete":"clear_image","change .wpmudev-answer-value":"update_value","change .wpmudev-quiz-results":"update_result","change .sui-toggle input":"update_toggle"},className:"sui-form-field",init:function(e){this.app=Forminator.Data.application||!1,this.results=e.results,this.question_index=e.question_index,this.answers=this.model.get("answers"),this.listenTo(Forminator.Events,"forminator:quiz:results:updated",this.render)},render:function(){this.$el.html(""),this.$el.append(this.get_label_html()),this.$el.append(this.get_field_html()),this.$el.removeClass("fui-has-answers"),this.answers.length>0&&this.$el.addClass("fui-has-answers"),this.trigger("rendered",this.get_value()),this.on_render()},get_values_html:function(){var e=this;return this.answers.map(function(t,i){return e.get_value_html(t,i)}).join(" ")},get_value_html:function(t,s){var n=(this.get_saved_value(),!1),a=Forminator.Utils.template(e(i).find("#settings-field-question-multiple-answer-tpl").html());return"nowrong"===this.app&&(n=this.results.toJSON()),a({row:t.toJSON(),index:s,question_index:this.question_index,type:this.app,results:n})},get_field_html:function(){var t=this.get_values_html();return Forminator.Utils.template(e(i).find("#settings-field-question-answer-list-tpl").html())({childs:t})},add_answer:function(e){e.preventDefault(),new_answer=new Forminator.Models.Answer({}),this.answers.add(new_answer,{silent:!0}),this.render()},delete_answer:function(t){t.preventDefault();var i=e(t.target),s=this.get_model(i);this.answers.remove(s,{silent:!0}),this.render()},get_index:function(e){return e.closest(".fui-answer").data("index")},get_model:function(e){var t=this.get_index(e);return this.answers.get_by_index(t)},move_option:function(e,t){var i=this.get_model(e),s=this.answers.model_index(i);this.answers.move_to(t,s),this.render()},update_value:function(t){var i=this.get_model(e(t.target)),s=e(t.target).val();i.set("title",s)},update_result:function(t){var i=this.get_model(e(t.target)),s=e(t.target).val();i.set("result",s)},update_toggle:function(t){t.preventDefault();var i=this.get_model(e(t.target));e(t.target).val();this.answers.each(function(e,t){e.set("toggle",!1)}),this.$el.find(".sui-toggle input").not(t.target).prop("checked",!1),e(t.target).is(":checked")?i.set("toggle",!0):i.set("toggle",!1)},toggle_answer:function(t){e(t.target).closest(".fui-answer").toggleClass("fui-answer-open")},add_image:function(t){t.preventDefault();var i=this,s=wp.media({title:this.options.popup_label,button:{text:this.options.popup_button_label},multiple:!1}).on("select",function(){var n,a=i.get_model(e(t.target)),r=s.state().get("selection").first().toJSON(),l=e(t.target).closest(".fui-answer"),u=l.find(".fui-browse-preview span"),o=l.find(".fui-browse"),d=o.find("input");r&&r.url&&(o.addClass("fui-browse-has-image"),n=r.url,_.isObject(r.sizes)&&(_.isObject(r.sizes.thumbnail)&&!_.isUndefined(r.sizes.thumbnail.url)?n=r.sizes.thumbnail.url:_.isObject(r.sizes.medium)&&!_.isUndefined(r.sizes.medium.url)?n=r.sizes.medium.url:_.isObject(r.sizes.large)&&!_.isUndefined(r.sizes.large.url)?n=r.sizes.large.url:_.isObject(r.sizes.full)&&!_.isUndefined(r.sizes.full.url)&&(n=r.sizes.full.url)),u.css("background-image","url('{url}')".replace("{url}",n)),d.val("{url}".replace("{url}",n)),a.set("image",n))});s.open()},clear_image:function(t){var i=this.get_model(e(t.target)),s=e(t.target).closest(".fui-answer"),n=s.find(".fui-browse-preview span"),a=s.find(".fui-browse"),r=a.find("input");a.removeClass("fui-browse-has-image"),n.css("background-image",""),r.val(""),i.set("image","")},on_render:function(){var t=this;setTimeout(function(){var i=e(".fui-multi-answer li:last-child").find(".sui-form-control"),s=i.val();Forminator.Utils.sui_delegate_events(),_.isEmpty(s)&&i.focus(),e(".fui-multi-answer").sortable({handle:".fui-answer-move-indicator i",update:function(e,i){t.move_option(i.item,i.item.index())}})},100)}})})}(jQuery);